<!doctype html>
<html lang="en-CA">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Contact The Long Math for calculator bug reports, technical corrections, media requests, or partnership inquiries. No individualized financial advice.">
  <title>Contact – The Long Math</title>

  <!-- Set theme before paint -->
  <script src="/assets/js/theme-init.js"></script>

  <!-- Site styles -->
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/contact/styles.css">

  <!-- Shared site behavior (menu, footer injection, etc.) -->
  <script defer src="/assets/js/site.js"></script>
</head>

<body>
  <div id="site-header"></div>
  <div class="wrap">
    <a class="home-link" href="/">← Back to Home</a>

    <main>
      <h1>Contact The Long Math</h1>

      <div class="contact-intro">
        <p>The Long Math is a math-first financial education platform.</p>
        <p>We welcome:<br>
        – Calculator bug reports<br>
        – Technical corrections<br>
        – Media and speaking inquiries<br>
        – Partnership discussions</p>
        <p>We do not provide personalized investment advice or portfolio reviews.</p>
      </div>

      <p class="contact-form-intro">Use the form below to submit your message.</p>

      <form class="contact-form" id="contact-form" action="#" method="post" novalidate>
        <div class="form-field">
          <label for="contact-name">Name <span class="required" aria-hidden="true">*</span></label>
          <input type="text" id="contact-name" name="name" required autocomplete="name">
        </div>

        <div class="form-field">
          <label for="contact-email">Email <span class="required" aria-hidden="true">*</span></label>
          <input type="email" id="contact-email" name="email" required autocomplete="email">
        </div>

        <div class="form-field">
          <label for="contact-category">Category <span class="required" aria-hidden="true">*</span></label>
          <select id="contact-category" name="category" required aria-describedby="category-desc">
            <option value="">Select…</option>
            <option value="general">General Feedback</option>
            <option value="bug">Calculator Bug</option>
            <option value="correction">Technical Correction</option>
            <option value="media">Media Inquiry</option>
            <option value="partnership">Partnership Inquiry</option>
          </select>
          <span id="category-desc" class="visually-hidden">Choose the type of inquiry.</span>
        </div>

        <div class="form-field">
          <label for="contact-message">Message <span class="required" aria-hidden="true">*</span></label>
          <textarea id="contact-message" name="message" rows="6" required maxlength="4000"></textarea>
        </div>

        <div class="form-field turnstile-wrap">
          <div class="cf-turnstile" data-sitekey="0x4AAAAAACduEzOSzh9DLkcJ"></div>
        </div>

        <div class="form-actions">
          <button type="submit" id="contact-submit">Submit</button>
          <span class="contact-status" id="contact-status" aria-live="polite"></span>
        </div>

        <p class="contact-privacy">Do not include account numbers or sensitive personal financial data.</p>
      </form>
    </main>

    <div id="footerMount"></div>
  </div>

  <!-- Turnstile script (keep OUTSIDE the form) -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

  <script>
    (function () {
      var form = document.getElementById('contact-form');
      var submitBtn = document.getElementById('contact-submit');
      var statusEl = document.getElementById('contact-status');
      if (!form || !submitBtn || !statusEl) return;

      form.addEventListener('submit', function (e) {
        e.preventDefault();

        var tokenInput = form.querySelector('[name="cf-turnstile-response"]');
        var token = tokenInput ? tokenInput.value : '';
        if (!token) {
          statusEl.textContent = 'Please complete the verification.';
          statusEl.className = 'contact-status contact-status-error';
          return;
        }

        statusEl.textContent = '';
        statusEl.className = 'contact-status';
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending…';

        fetch('/api/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: (form.querySelector('[name="name"]').value || '').trim(),
            email: (form.querySelector('[name="email"]').value || '').trim(),
            category: form.querySelector('[name="category"]').value,
            message: (form.querySelector('[name="message"]').value || '').trim(),
            turnstileToken: token
          })
        })
          .then(function (res) {
            return res.text().then(function (t) {
              var data = {};
              try { data = t ? JSON.parse(t) : {}; } catch (e) {}
              return { ok: res.ok, status: res.status, data: data };
            });
          })
          .then(function (result) {
            if (result.ok && result.data && result.data.ok) {
              submitBtn.textContent = 'Sent';
              statusEl.textContent = 'Your message has been sent.';
              statusEl.className = 'contact-status contact-status-success';
              form.reset();
              if (typeof turnstile !== 'undefined' && turnstile.reset) turnstile.reset();
              return;
            }

            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit';

            var err = (result.data && result.data.error) ? result.data.error : '';
            var msg =
              err === 'turnstile_failed' ? 'Verification failed. Please try again.' :
              err === 'validation' ? 'Please check the fields and try again.' :
              err === 'content_type' ? 'Submission failed. Please refresh and try again.' :
              'Something went wrong. Please try again.';

            statusEl.textContent = msg;
            statusEl.className = 'contact-status contact-status-error';
          })
          .catch(function () {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit';
            statusEl.textContent = 'Something went wrong. Please try again.';
            statusEl.className = 'contact-status contact-status-error';
          });
      });
    })();
  </script>
</body>
</html>
